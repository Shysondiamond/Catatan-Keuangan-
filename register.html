<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin - JedaBisnis</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body { background:#0e0e17; color:white; font-family:Inter,sans-serif; padding:2rem; }
    h1 { color:#ff85c1; }
    table { width:100%; border-collapse:collapse; margin-top:1rem; }
    th, td { padding:8px; border-bottom:1px solid rgba(255,255,255,0.1); }
    img { max-width:60px; border-radius:8px; }
    button { background:#ff85c1; border:none; color:white; padding:5px 10px; border-radius:6px; cursor:pointer; }
    button:hover { background:#ff6fab; }
  </style>
</head>
<body>
  <h1>Dashboard Admin</h1>
  <button id="logoutBtn">Logout</button>
  <table>
    <thead><tr><th>Nama</th><th>Jenis</th><th>Telepon</th><th>Pemilik</th><th>Status</th><th>Bukti</th><th>Aksi</th></tr></thead>
    <tbody id="businessList"></tbody>
  </table>

  <script>
    const firebaseConfig = {
      apiKey: "ISI_API_KEY_KAMU",
      authDomain: "ISI_AUTH_DOMAIN",
      databaseURL: "ISI_DATABASE_URL",
      projectId: "ISI_PROJECT_ID",
      storageBucket: "ISI_STORAGE_BUCKET",
      messagingSenderId: "ISI_MSG_SENDER_ID",
      appId: "ISI_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    const adminEmails = ["admin@gmail.com", "rifaldo@jedabisnis.com"];
    const list = document.getElementById('businessList');
    const logoutBtn = document.getElementById('logoutBtn');

    logoutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (!user) return window.location.href = "index.html";
      if (!adminEmails.includes(user.email)) return window.location.href = "index.html";
      loadData();
    });

    function loadData() {
      db.ref('bisnis').on('value', snap => {
        list.innerHTML = '';
        snap.forEach(child => {
          const key = child.key;
          const b = child.val();
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${b.nama}</td>
            <td>${b.jenis}</td>
            <td>${b.telp}</td>
            <td>${b.pemilik}</td>
            <td>${b.status}</td>
            <td>${b.bukti ? `<img src="${b.bukti}">` : '-'}</td>
            <td>
              <button onclick="beriPesan('${key}','Diterima')">✅ Setujui</button>
              <button onclick="beriPesan('${key}','Ditolak')">❌ Tolak</button>
            </td>
          `;
          list.appendChild(row);
        });
      });
    }

    function beriPesan(id, status) {
      const pesan = prompt("Tulis pesan untuk pengguna:");
      if (pesan !== null) {
        db.ref('bisnis/' + id).update({ status, pesan });
        alert("Status diubah menjadi " + status);
      }
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JedaBisnis Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<style>
  *{box-sizing:border-box;font-family:'Poppins',sans-serif;}
  body{
    margin:0;background:#0a0a0f;color:#fff;
    display:flex;justify-content:center;align-items:center;
    min-height:100vh;
  }
  .container{
    width:95%;max-width:950px;
    background:rgba(30,30,40,0.95);
    border-radius:16px;
    padding:25px;
    box-shadow:0 0 30px rgba(255,20,147,0.25);
  }
  h1{text-align:center;color:#ff69b4;margin-bottom:20px;}
  button{
    background:#ff69b4;border:none;padding:10px 18px;border-radius:8px;
    cursor:pointer;color:#fff;font-weight:600;transition:0.3s;
  }
  button:hover{background:#ff85c1;}
  .form-group{margin:10px 0;}
  input,select{
    width:100%;padding:10px;border-radius:8px;border:1px solid #333;
    background:#1a1a24;color:#fff;
  }
  .hidden{display:none;}
  table{width:100%;border-collapse:collapse;margin-top:20px;}
  th,td{padding:10px;border-bottom:1px solid #333;text-align:left;}
  .status{font-weight:600;}
  .info-link{color:#ff69b4;cursor:pointer;text-decoration:underline;}
  .popup{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center;
    z-index:999;
  }
  .popup-content{
    background:#1a1a24;padding:20px;border-radius:12px;
    width:90%;max-width:500px;box-shadow:0 0 25px rgba(255,105,180,0.4);
  }
  .popup-content h3{color:#ff69b4;}
  .close-btn{
    background:#333;border:none;padding:8px 14px;border-radius:6px;
    color:#fff;cursor:pointer;float:right;
  }
</style>
</head>
<body>
<div class="container">
  <h1>JedaBisnis</h1>

  <div id="auth-section">
    <button id="googleLogin">Login dengan Google</button>
  </div>

  <div id="register-section" class="hidden">
    <h2>Daftar Bisnis Baru</h2>
    <div class="form-group"><label>Nama Bisnis</label><input type="text" id="namaBisnis"></div>
    <div class="form-group"><label>Jenis Bisnis</label><input type="text" id="jenisBisnis"></div>
    <div class="form-group"><label>Nomor Telepon</label><input type="text" id="telepon"></div>
    <p><s>Rp100.000</s> <b>Rp99.000</b></p>
    <button id="daftarBtn">Daftar Sekarang</button>
    <p id="regInfo"></p>
    <div id="progressSection"></div>
  </div>

  <div id="admin-section" class="hidden">
    <h2>Dashboard Admin</h2>
    <table>
      <thead>
        <tr>
          <th>Nama Bisnis</th>
          <th>Pemilik</th>
          <th>Status</th>
          <th>Tindakan</th>
        </tr>
      </thead>
      <tbody id="ordersList"></tbody>
    </table>
  </div>
</div>

<!-- Popup Informasi -->
<div id="popup" class="popup hidden">
  <div class="popup-content">
    <button class="close-btn" onclick="closePopup()">Tutup</button>
    <h3>Informasi Dashboard</h3>
    <p id="popupText"></p>
  </div>
</div>

<script>
  // ðŸ”¥ Firebase config (ganti dengan punyamu)
  const firebaseConfig = {
  apiKey: "AIzaSyD_4hkC5918dHoQEOqyZ7FHR02eHx25rzM",
  authDomain: "register-7883a.firebaseapp.com",
  projectId: "register-7883a",
  storageBucket: "register-7883a.firebasestorage.app",
  messagingSenderId: "900344098901",
  appId: "1:900344098901:web:b95b608dacbac8285964dc",
  measurementId: "G-L3CGV1P69Y"
};
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  const adminEmails = ["admin@jedabisnis.com"];

  const authSection=document.getElementById("auth-section");
  const registerSection=document.getElementById("register-section");
  const adminSection=document.getElementById("admin-section");
  const daftarBtn=document.getElementById("daftarBtn");
  const ordersList=document.getElementById("ordersList");
  const progressSection=document.getElementById("progressSection");
  const popup=document.getElementById("popup");
  const popupText=document.getElementById("popupText");

  document.getElementById("googleLogin").onclick=async()=>{
    const provider=new firebase.auth.GoogleAuthProvider();
    const result=await auth.signInWithPopup(provider);
    const user=result.user;
    checkRole(user);
  };

  function checkRole(user){
    authSection.classList.add("hidden");
    if(adminEmails.includes(user.email)){
      adminSection.classList.remove("hidden");
      loadOrders();
    }else{
      registerSection.classList.remove("hidden");
      loadUserOrder(user.email);
    }
  }

  daftarBtn.onclick=()=>{
    const nama=document.getElementById("namaBisnis").value;
    const jenis=document.getElementById("jenisBisnis").value;
    const telp=document.getElementById("telepon").value;
    const user=auth.currentUser;
    if(!nama||!jenis||!telp){alert("Lengkapi semua data!");return;}
    const newRef=db.ref("orders").push();
    newRef.set({
      userEmail:user.email,
      namaBisnis:nama,
      jenisBisnis:jenis,
      telepon:telp,
      status:"Menunggu Pembayaran",
      dashboardLink:"",
      infoDashboard:""
    });
    document.getElementById("regInfo").innerText="Pendaftaran berhasil! Menunggu pembayaran...";
  };

  // === USER MELIHAT PROGRESNYA ===
  function loadUserOrder(email){
    db.ref("orders").orderByChild("userEmail").equalTo(email).on("value",snap=>{
      progressSection.innerHTML="";
      snap.forEach(child=>{
        const d=child.val();
        const div=document.createElement("div");
        div.innerHTML=`
          <p><b>${d.namaBisnis}</b></p>
          <p>Status: ${d.status}</p>
          ${d.status==="Dashboard Berhasil Dibuat" ? 
            `<p><a class="info-link" onclick="showInfo('${child.key}')">Lihat Informasi</a></p>`:""}
        `;
        progressSection.appendChild(div);
      });
    });
  }

  // === ADMIN DASHBOARD ===
  function loadOrders(){
    db.ref("orders").on("value",snap=>{
      ordersList.innerHTML="";
      snap.forEach(child=>{
        const data=child.val();
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${data.namaBisnis}</td>
          <td>${data.userEmail}</td>
          <td>${data.status}</td>
          <td>
            <button onclick="nextStage('${child.key}')">Lanjut</button>
            <button onclick="cancelOrder('${child.key}')">Batalkan</button>
          </td>`;
        ordersList.appendChild(tr);
      });
    });
  }

  const stages=[
    "Menunggu Pembayaran",
    "Menunggu Konfirmasi Admin",
    "Admin Telah Mengkonfirmasi",
    "Proses Pembuatan Dashboard",
    "Dashboard Berhasil Dibuat"
  ];

  window.nextStage=(id)=>{
    const ref=db.ref("orders/"+id);
    ref.once("value",snap=>{
      const data=snap.val();
      let nextIndex=stages.indexOf(data.status)+1;
      if(nextIndex>=stages.length)return;
      const newStatus=stages[nextIndex];
      const updates={status:newStatus};
      if(newStatus==="Dashboard Berhasil Dibuat"){
        const link=prompt("Masukkan link dashboard:");
        const info=prompt("Tulis informasi tambahan untuk user:");
        if(link)updates.dashboardLink=link;
        if(info)updates.infoDashboard=info;
      }
      ref.update(updates);
    });
  };

  window.cancelOrder=(id)=>{
    if(confirm("Batalkan pesanan ini?")) db.ref("orders/"+id).remove();
  };

  // === POPUP INFORMASI USER ===
  window.showInfo=(id)=>{
    db.ref("orders/"+id).once("value",snap=>{
      const d=snap.val();
      popupText.innerHTML=`
        <p><b>Link Dashboard:</b> <a href="${d.dashboardLink}" target="_blank">${d.dashboardLink}</a></p>
        <p>${d.infoDashboard}</p>
      `;
      popup.classList.remove("hidden");
    });
  };
  window.closePopup=()=>popup.classList.add("hidden");

  auth.onAuthStateChanged(u=>{if(u)checkRole(u);});
</script>
</body>
</html>
